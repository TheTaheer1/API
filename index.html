<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>API</title>

    <style>
        body {
            font-family: Arial;
            text-align: center;
            margin-top: 60px;
        }

        input,
        button {
            padding: 8px 14px;
            font-size: 16px;
            margin: 5px;
        }

        #display {
            font-size: 40px;
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h2>‚è±Ô∏è Countdown Timer</h2>

    <input id="seconds" type="number" placeholder="Seconds" min="1">
    <button id="startBtn">Start</button>
    <button onclick="resetTimer()">Reset</button>

    <div id="display">0</div>

    <script>
        let interval;
        let audioCtx;
        let unlocked = false;


        function unlockAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }

            if (audioCtx.state === "suspended") {
                audioCtx.resume();
            }

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            gain.gain.value = 0;

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.01);

            unlocked = true;
        }


        // üî• Safari + Chrome Notification Permission
        function ensureNotificationPermission() {
            if (!("Notification" in window)) return;

            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        }


        function playBeep() {
            if (!audioCtx) return;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = "sine";
            osc.frequency.value = 800;

            gain.gain.value = 0.4;

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function notifyUser() {
            if ("Notification" in window) {
                if (Notification.permission === "granted") {
                    new Notification('Timer Finished!');
                }
            }
        }

        function startTimer() {
            unlockAudio();

            ensureNotificationPermission(); // Required for Safari

            let sec = parseInt(seconds.value);

            if (!sec || sec <= 0) {
                alert("Enter valid seconds");
                return;
            }

            clearInterval(interval);

            display.textContent = sec + (sec === 1 ? " second" : " seconds");

            interval = setInterval(() => {
                sec--;

                if (sec > 0) {
                    display.textContent = sec + (sec === 1 ? " second" : " seconds");
                } else {
                    clearInterval(interval);
                    display.textContent = "‚è∞ Time's up!";

                    playBeep();
                    notifyUser();
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(interval);
            display.textContent = "0";
            seconds.value = "";
        }

        document.getElementById("startBtn").onclick = startTimer;


        // üî• Enter OR Shift starts timer (cursor anywhere)
        document.addEventListener("keydown", e => {
            if (e.key === "Enter" || e.key === "Shift") {
                startTimer();
            }
        });


        // Input ke andar Enter dabane par bhi chale
        seconds.addEventListener("keydown", e => {
            if (e.key === "Enter" || e.key === "Shift") {
                startTimer();
            }
        });
    </script>

</body>

</html>